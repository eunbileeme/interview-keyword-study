# 고청천

## 로드 밸런서/로드밸런싱

### 로드 밸런서와 로드 밸런싱 차이

로드 밸런서는 서버에 오는 트래픽을 여러 대의 서버에 분산 시켜주는 역할을 하는,기기이며 로드 밸런싱은 자원의 요청을 여러 서버에 균등하게 분산시켜주는 역할을 합니다

### 로드 밸런싱 작동 방식

대표적인 로드 밸런싱 알고리즘으로는 라운드 로빈 방식과 최소 연결 방식 그리고이 Fastest Response Time 있습니다

라운드 로빈 방식은 클라에게 받은 요충을 로드밸런싱 대상 서버에 순서대로 할당하는 방식입니다 이를 통해 균등한 분산처리를 할 수 있습니다

최소 연결 방식은 최소 라우팅 서버에 우선적으로 배치하는 방식입니다 동적인 분산 알고리즘으로 각 서버에 대한 현재 연결 수를 동적으로 카운트 할 수 있으며 동적으로 변하는 요청에 대한 부하를 분산 시킬 수 있습니다

Fastest Response Time은 서버가 요청에 대한 응답하는 시간을 체크해 가장 빠른 서버로 요청보냅니다

### 로드 밸런싱 등장 배경

웹의 발전에 따라 사용자 수가 늘어나게 되고, 단일 서버로는 감당하기 힘든 트래픽이 들어오게 되어서 이를 분산 시켜 서버의 부담을 낮추고자 등장하게 되었습니다

### L4, L7 로드 밸런서 차이

L4 로드 밸런서는 TCP/UDP 가 속한 전송 계층에서 로드 밸런싱을 합니다 데이터를 변경 수정할 수 없으며, 패킷 레벨에서만 트래픽을 분산해서 속도가 빠르고 효율이 높습니다

L7 로드 밸런서는 L7위에서 동작하기 때문에 ip, port 이외에도 URI payload HTTP header, cookie등의 내용을 기준으로 부하를 분산합니다. 포트나 헤더 등의 정보를 수정할 수 있습니다 패킷 내용을 확인하고 그 내용에 따라 트래픽을 특정 서버에 분산하는 것이 가능합니다 데이터를 분석해서 처리가 가능하기 때문에 악의적이거나 비 정상적인 콘텐츠를 감지해 보안 지점을 구축할 수도 잇는 장점이 있고, 그만큼 자원 소모가 크다는 단점이 있습니다.



## Nginx

### Nginx 사용 이유

Nginx 를 통해 단일 진입점을 제공합니다. 여러 서버 컨테이너가 띄워져있을 때, Nginx 를 통해 적절한 서버로 요청을 날릴 수 있습니다

캐싱을 통해 성능 향상 이점도 가집니다. 동적/정적 컨텐츠 모두에 마이크로 캐싱을 구현해 짧은 기간 동안 데이터 캐시함으로 백앤드 인프라 부하를 줄일 수 있습니다

### Nginx의 핵심 동작 원리

Nginx 는 Non blocking IO를 통해 하나의 쓰레드가 IO로 막히지 않고 다른 작업을 할 수 있다는 장점을 가지고 있습니다.

또한 스레드 풀을 통해 성능을 최적화 합니다 각 요청마다 새로운 스레드를 생성하고 파기하는 오버헤드를 줄일 수 있습니다. 차단 작업을 별도의 스레드에서 처리함으로써, 메인 이벤트 루프는 네트워크 요청과 같은 덜 리소스 집약적인 작업에 집중할 수 있습니다.



## 보안

### TSL 과 SSL

HTTP를 사용한 웹에서의 데이터는 가로채면 누구나 읽을 수 있는 일반 텍스트 형태로 전송 되었습니다. 이러한 문제를화방지하고자 암호화를 통해 안전하게 통신하기 위해서입니다.

SSL은 웹에서 전송되는 데이터들을 암호화 합니다. 따라서, 데이터를 가로채도 복호화가 거의 불가능합니다.

SSL은 클라이언트와 서버간에 HandShaking을 통해 인증이 이루어집니다. 또한 데이터 무결성을 위해 데이터에 디지털 서명을 하여 데이터가 의도적으로 도착하기 전에 조작된 여부를 확인합니다.

### CSRF 공격

CSRF 공격은 사용자가 이미 인증된 웹사이트에 로그인한 상태에서, 공격자가 만든 악의적인 요청을 그 사용자의 브라우저를 통해 해당 사이트에 전송하게 만드는 것입니다.

악의적 링크나 자동 실행 스크립트등을 통해 이러한 공격이 가능합니다

### XSS 공격

악의적인 스크립트를 사용자의 브라우저에 주입하는 공격입니다. 이 스크립트는 사용자가 방문하는 웹 페이지 내에서 실행되어, 사용자의 세션 토큰이나 쿠키를 탈취하거나 사용자를 속여 다른 행동을 하게 만들 수 있습니다.

악의적 스크립트를 웹 서버에 저장하여 다른 사용자가 해당 페이지를 방문 할 때마다 스크립트를 실행하는 방식등으로 가능합니다

### CORS 란?

웹 페이지가 다른 도메인의 리소스를 안전하게 요청할 수 있도록 해주는 보안 메커니즘입니다. 기본 적으로 웹 브라우저는 동일 출처 정책을 따릅니다. 이 정책은 보안상의 이유로, 한 출처에서 로드된 문서나 스크립트가 다른 출처의 리소스와 상호 작용하는 것을 제한합니다.

Simple requests인 경우 서버의 응답이 왔을 때 브라우저가 요청한 Origin과 응답한 헤더 Access-Control-Request-Headers의 값을 비교하여 유효한 요청이라면 리소스를 응답합니다. 만약 유효하지 않은 요청이라면 브라우저에서 이를 막고 에러가 발생합니다.

preflight 요청일 경우 Origin헤더에 현재 요청하는 origin과, Access-Control-Request-Method헤더에 요청하는 HTTP method와 Access-Control-Request-Headers요청 시 사용할 헤더를 OPTIONS 메서드로 서버로 요청합니다. 이때 내용물은 없이 헤더만 전송합니다. 브라우저가 서버에서 응답한 헤더를 보고 유효한 요청인지 확인합니다. 만약 유효하지 않은 요청이라면 요청은 중단되고 에러가 발생합니다.

만약 유효한 요청이라면 원래 요청으로 보내려던 요청을 다시 요청하여 리소스를 응답받습니다.



## 종합

### 브라우저에 www.google.com 을 입력했을 때 일어나는 일

1. 웹브라우저는 캐싱된 DNS 기록들을 통해 해당 도메인주소와 대응하는 IP주소를 확인
2. 웹브라우저가 HTTP를 사용하여 DNS에게 입력된 도메인 주소를 요청
3. DNS가 웹브라우저에게 찾는 사이트의 IP주소를 응답 ( DNS 쿼리) 3-1 root name server에 연락&#x20;

&#x20;       3-2 .com 도메인 name server로 리다이렉트&#x20;

&#x20;       3-3 google.com name server로 리다이렉트&#x20;

&#x20;      3-4 최종적으로 DNS기록에서 'www.google.com' 에 매칭되는 IP주소 찾고 내보내기

4. 웹브라우저가 웹서버에게 IP주소를 이용하여 html문서를 요청
